# æ–°èçˆ¬èŸ²æ¨¡çµ„ä½¿ç”¨ç¯„ä¾‹

## ğŸ“– ç›®éŒ„

1. [æ–¹å¼ 1ï¼šç¨ç«‹é‹è¡Œ](#æ–¹å¼-1ç¨ç«‹é‹è¡Œ)
2. [æ–¹å¼ 2ï¼šæ¨¡çµ„èª¿ç”¨](#æ–¹å¼-2æ¨¡çµ„èª¿ç”¨)
3. [æ–¹å¼ 3ï¼šåœ¨ app.py ä¸­çš„æ•´åˆ](#æ–¹å¼-3åœ¨-apppy-ä¸­çš„æ•´åˆ)

---

## æ–¹å¼ 1ï¼šç¨ç«‹é‹è¡Œ

### å‘½ä»¤åˆ—åŸ·è¡Œ

```bash
cd c:\project\github_push\greenwashing_detective_project
python news_search/crawler_news.py
```

### äº’å‹•å¼è¼¸å…¥

```
=== ESG å ±å‘Šæ›¸æ–°èçˆ¬èŸ² ===

è«‹è¼¸å…¥å¹´ä»½ (é è¨­ 2024): 2024
è«‹è¼¸å…¥å…¬å¸ä»£ç¢¼ (é è¨­ 1102): 1102
æ˜¯å¦å¼·åˆ¶é‡æ–°ç”Ÿæˆï¼Ÿ(y/N): n
```

### è¼¸å‡ºç¯„ä¾‹ï¼ˆæª”æ¡ˆå·²å­˜åœ¨ï¼‰

```
â„¹ï¸ æ–°èè³‡æ–™å·²å­˜åœ¨ï¼Œè·³éç”Ÿæˆ
ğŸ“ æª”æ¡ˆä½ç½®: news_search/news_output/2024_1102_news.json
ğŸ“Š æ–°èæ•¸é‡: 61
```

### è¼¸å‡ºç¯„ä¾‹ï¼ˆé¦–æ¬¡åŸ·è¡Œï¼‰

```
é–‹å§‹åŸ·è¡Œæ–°èæœå°‹ï¼Œå…± 26 ç­†è³‡æ–™...
============================================================
[1/26] æŸ¥æ ¸: äºæ³¥ (1102) - æº«å®¤æ°£é«”æ’æ”¾
  ğŸ”§ ä½¿ç”¨ SASB é—œéµå­—ç”Ÿæˆ: äºæ³¥ æº«å®¤æ°£é«”æ’æ”¾ æº«å®¤æ°£é«” ç¢³æ’æ”¾ æ·¨é›¶
  ğŸ“… æœç´¢ç¯„åœ: 2024/01/01 ~ 2024/12/31
  ğŸ” æœå°‹ç­–ç•¥1: äºæ³¥ æº«å®¤æ°£é«”æ’æ”¾ æº«å®¤æ°£é«” ç¢³æ’æ”¾ æ·¨é›¶
  ğŸ“° å…±æ‰¾åˆ° 10 å‰‡æ–°èï¼Œé–‹å§‹éæ¿¾...
  âœ“ ä¿ç•™ 7 å‰‡ 2024 å¹´æ–°èï¼ˆæ’é™¤ 3 å‰‡ï¼‰
------------------------------------------------------------
[2/26] æŸ¥æ ¸: äºæ³¥ (1102) - ç©ºæ°£å“è³ª
  ğŸ”§ ä½¿ç”¨ SASB é—œéµå­—ç”Ÿæˆ: äºæ³¥ ç©ºæ°£å“è³ª ç©ºæ°£å“è³ª ç©ºæ±™ æ’æ”¾å»¢æ°£
  ğŸ“… æœç´¢ç¯„åœ: 2024/01/01 ~ 2024/12/31
...

============================================================
âœ… æ–°èæœå°‹å®Œæˆï¼
ğŸ“ çµæœå·²å„²å­˜è‡³: news_search/news_output/2024_1102_news.json
ğŸ“Š çµ±è¨ˆ:
   - è™•ç†é …ç›®æ•¸: 26
   - æˆåŠŸé …ç›®æ•¸: 24
   - å¤±æ•—é …ç›®æ•¸: 2
   - æ–°èç¸½æ•¸: 61
   - åŸ·è¡Œæ™‚é–“: 98.3 ç§’
============================================================
```

---

## æ–¹å¼ 2ï¼šæ¨¡çµ„èª¿ç”¨

### åŸºæœ¬ä½¿ç”¨

```python
from news_search.crawler_news import search_news_for_report

# è‡ªå‹•æœå°‹ P1 JSON
result = search_news_for_report(year=2024, company_code="1102")

# æª¢æŸ¥çµæœ
if result['success']:
    print(f"âœ… æˆåŠŸï¼š{result['output_file']}")
    print(f"ğŸ“Š æ–°èæ•¸é‡ï¼š{result['news_count']}")
    print(f"ğŸ“‹ è™•ç†é …ç›®ï¼š{result['processed_items']}")
    print(f"âŒ å¤±æ•—é …ç›®ï¼š{result['failed_items']}")
else:
    print(f"âŒ å¤±æ•—ï¼š{result['error']}")
```

### æŒ‡å®š P1 JSON è·¯å¾‘

```python
result = search_news_for_report(
    year=2024,
    company_code="1102",
    p1_json_path="temp_data/prompt1_json/2024_1102_P1.json"
)
```

### å¼·åˆ¶é‡æ–°ç”Ÿæˆ

```python
result = search_news_for_report(
    year=2024,
    company_code="1102",
    force_regenerate=True  # å¿½ç•¥ç¾æœ‰æª”æ¡ˆï¼Œå¼·åˆ¶é‡æ–°ç”Ÿæˆ
)
```

### å›å‚³æ ¼å¼

```python
# æˆåŠŸï¼ˆé¦–æ¬¡ç”Ÿæˆï¼‰
{
    'success': True,
    'output_file': 'news_search/news_output/2024_1102_news.json',
    'news_count': 61,
    'processed_items': 26,
    'failed_items': 2,
    'skipped': False,
    'failure_details': [
        {'topic': 'é¡§å®¢æ¬Šç›Š', 'reason': 'API timeout'}
    ]
}

# æˆåŠŸï¼ˆè·³éç”Ÿæˆï¼‰
{
    'success': True,
    'output_file': 'news_search/news_output/2024_1102_news.json',
    'news_count': 61,
    'processed_items': 0,
    'failed_items': 0,
    'skipped': True
}

# å¤±æ•—
{
    'success': False,
    'error': 'æ‰¾ä¸åˆ° P1 JSON æª”æ¡ˆ: 2024_1102_P1.json'
}
```

---

## æ–¹å¼ 3ï¼šåœ¨ app.py ä¸­çš„æ•´åˆ

### è‡ªå‹•åŸ·è¡Œæµç¨‹

ç•¶ä½¿ç”¨è€…é€é `/api/query_company` æŸ¥è©¢å…¬å¸æ™‚ï¼š

```
POST /api/query_company
{
  "year": 2024,
  "company_code": "1102",
  "auto_fetch": true
}
```

### åŸ·è¡Œæµç¨‹

```
1. æª¢æŸ¥è³‡æ–™åº« (Step 1)
    â†“ è³‡æ–™ä¸å­˜åœ¨
2. ä¸‹è¼‰ PDF (Step 2)
    â†“ ä¸‹è¼‰æˆåŠŸ
3a. Word Cloud ç”Ÿæˆ â”
                     â”œâ”€ å¹³è¡ŒåŸ·è¡Œ
3b. AI åˆ†æ         â”˜
    â†“ å…©è€…å®Œæˆ
4. æ–°èçˆ¬èŸ²æœå°‹ âœ¨ NEW
    â†“ å®Œæˆï¼ˆå¤±æ•—ä¸å½±éŸ¿ï¼‰
5. å­˜å…¥è³‡æ–™åº« (Step 5)
    â†“
6. æ›´æ–°ç‹€æ…‹ (Step 6)
    â†“
7. å›å‚³çµæœ (Step 7)
```

### å¾Œç«¯æ—¥èªŒ

```
ğŸš€ å•Ÿå‹•å¹³è¡Œè™•ç†ï¼šWord Cloud èˆ‡ AI åˆ†æ
âœ… Word Cloud ç”ŸæˆæˆåŠŸ: 100 å€‹é—œéµå­—
âœ… AI åˆ†æå®Œæˆ

--- Step 4: æ–°èçˆ¬èŸ²é©—è­‰ ---
é–‹å§‹åŸ·è¡Œæ–°èæœå°‹ï¼Œå…± 26 ç­†è³‡æ–™...
[1/26] æŸ¥æ ¸: äºæ³¥ (1102) - æº«å®¤æ°£é«”æ’æ”¾
  ğŸ”§ ä½¿ç”¨ SASB é—œéµå­—ç”Ÿæˆ
  âœ“ ä¿ç•™ 7 å‰‡ 2024 å¹´æ–°è
...
âœ… æ–°èæœå°‹å®Œæˆï¼
   è™•ç†é …ç›®: 26
   å¤±æ•—é …ç›®: 2
```

### éŒ¯èª¤è™•ç†ï¼ˆä¸ä¸­æ–·æµç¨‹ï¼‰

```
--- Step 4: æ–°èçˆ¬èŸ²é©—è­‰ ---
âš ï¸ æ–°èçˆ¬èŸ²ç™¼ç”ŸéŒ¯èª¤: No module named 'gnews'ï¼ˆä¸å½±éŸ¿ä¸»æµç¨‹ï¼‰

ç¹¼çºŒåŸ·è¡Œ Step 5...
```

---

## ğŸ”§ é€²éšç”¨æ³•

### æ‰¹æ¬¡è™•ç†å¤šå®¶å…¬å¸

```python
from news_search.crawler_news import search_news_for_report

companies = ["1101", "1102", "1314", "2330"]
year = 2024

for company_code in companies:
    print(f"\nè™•ç†ï¼š{company_code}")
    result = search_news_for_report(year, company_code)
    
    if result['success']:
        if result['skipped']:
            print(f"  â­ï¸ å·²å­˜åœ¨ï¼Œè·³é")
        else:
            print(f"  âœ… ç”ŸæˆæˆåŠŸï¼š{result['news_count']} å‰‡æ–°è")
            print(f"     å¤±æ•—é …ç›®ï¼š{result['failed_items']}")
    else:
        print(f"  âŒ å¤±æ•—ï¼š{result['error']}")
```

### éŒ¯èª¤è™•ç†

```python
result = search_news_for_report(year=2024, company_code="9999")

if not result['success']:
    error = result.get('error', 'æœªçŸ¥éŒ¯èª¤')
    
    if 'æ‰¾ä¸åˆ° P1 JSON' in error:
        print("è«‹å…ˆåŸ·è¡Œ AI åˆ†æç”Ÿæˆ P1 JSON")
    elif 'è®€å– P1 JSON å¤±æ•—' in error:
        print("P1 JSON æª”æ¡ˆå¯èƒ½æå£")
    elif 'å„²å­˜æª”æ¡ˆå¤±æ•—' in error:
        print("ç£ç¢Ÿç©ºé–“ä¸è¶³æˆ–æ¬Šé™å•é¡Œ")
    else:
        print(f"å…¶ä»–éŒ¯èª¤ï¼š{error}")
```

### æª¢è¦–å¤±æ•—è©³æƒ…

```python
result = search_news_for_report(year=2024, company_code="1102")

if result['success'] and result.get('failure_details'):
    print(f"\nâš ï¸ æœ‰ {len(result['failure_details'])} å€‹é …ç›®æœå°‹å¤±æ•—ï¼š")
    for detail in result['failure_details']:
        print(f"  - {detail['topic']}: {detail['reason']}")
```

---

## ğŸ“Š è¼¸å‡ºæª”æ¡ˆä½ç½®

| é …ç›® | è·¯å¾‘ |
|------|------|
| **JSON æª”æ¡ˆ** | `news_search/news_output/{year}_{company_code}_news.json` |
| **ç¯„ä¾‹** | `news_search/news_output/2024_1102_news.json` |

---

## ğŸ” å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼ç¬¬äºŒæ¬¡åŸ·è¡Œå¾ˆå¿«ï¼Ÿ
A: åŠ å…¥äº†æª”æ¡ˆå­˜åœ¨æ€§æª¢æŸ¥æ©Ÿåˆ¶ï¼Œè‹¥ JSON å·²å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢ºï¼Œç›´æ¥è¿”å›ï¼ˆ< 0.5 ç§’ï¼‰ã€‚

### Q2: å¦‚ä½•å¼·åˆ¶é‡æ–°ç”Ÿæˆï¼Ÿ
A: è¨­å®š `force_regenerate=True` åƒæ•¸ã€‚

### Q3: æ–°èçˆ¬èŸ²å¤±æ•—æœƒå½±éŸ¿ä¸»æµç¨‹å—ï¼Ÿ
A: ä¸æœƒã€‚æ–°èçˆ¬èŸ²æ˜¯éå¿…è¦åŠŸèƒ½ï¼Œå¤±æ•—åªæœƒè¨˜éŒ„æ—¥èªŒï¼Œä¸å½±éŸ¿ AI åˆ†æå’Œè³‡æ–™åº«å„²å­˜ã€‚

### Q4: P1 JSON æ²’æœ‰ key_word æ€éº¼è¾¦ï¼Ÿ
A: æ¨¡çµ„å·²å¯¦ä½œä¸‰å±¤ç´š fallback æ©Ÿåˆ¶ï¼Œæœƒè‡ªå‹•å¾ SASB é—œéµå­—è¡¨ç”Ÿæˆã€‚

### Q5: ç‚ºä»€éº¼æœ‰äº›è­°é¡Œæ‰¾ä¸åˆ°æ–°èï¼Ÿ
A: å¯èƒ½åŸå› ï¼š
- è©²è­°é¡Œé—œéµå­—åœ¨ 2024 å¹´æ²’æœ‰ç›¸é—œæ–°è
- GNews API æœªæ”¶éŒ„ç›¸é—œæ–°è
- æœå°‹é—œéµå­—ä¸å¤ ç²¾ç¢º

### Q6: æ–°èæ•¸é‡ç‚ºä½•ä¸ä¸€è‡´ï¼Ÿ
A: å› ç‚ºéæ¿¾äº†ç›®æ¨™å¹´ä»½å¤–çš„æ–°èï¼Œä¸”ä¸åŒè­°é¡Œçš„æ–°èé‡æœ¬ä¾†å°±ä¸åŒã€‚

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** 1.0  
**æœ€å¾Œæ›´æ–°ï¼š** 2026-01-14
