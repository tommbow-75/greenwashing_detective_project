-- 1. 公司基本資料表
CREATE TABLE IF NOT EXISTS companies (
    id INT AUTO_INCREMENT PRIMARY KEY,
    stock_id VARCHAR(10) NOT NULL,
    name VARCHAR(100) NOT NULL,
    industry VARCHAR(50) NOT NULL, -- 對應 JSON 中的產業欄位名稱
    year INT NOT NULL,
    UNIQUE KEY unique_company (stock_id, year)
);

-- 2. 詳細 ESG 分析數據表 (用於計算)
CREATE TABLE IF NOT EXISTS esg_details (
    id INT AUTO_INCREMENT PRIMARY KEY,
    company_id INT NOT NULL,
    category ENUM('E', 'S', 'G') NOT NULL,
    sasb_topic VARCHAR(100) NOT NULL, -- 必須完全對應 JSON 中的 "議題"
    report_claim TEXT,                -- 報告宣稱 (前端顯示用)
    external_evidence TEXT,           -- 外部證據 (前端顯示用)
    risk_score INT DEFAULT 4,         -- 初始分數 (0-4)
    adjustment_score INT DEFAULT 0,   -- 調整分數 (扣分項)
    page_number VARCHAR(20),
    FOREIGN KEY (company_id) REFERENCES companies(id) ON DELETE CASCADE
);

-- 模擬資料種子 (範例)
INSERT INTO companies (stock_id, name, industry, year) VALUES 
('2330', '台積電', '半導體業', 2024),
('1314', '中石化', '油電燃氣業', 2024);

-- 插入一些詳細數據供計算測試
-- 假設: 半導體業在 "溫室氣體排放" 權重是 2 (依據 JSON)
INSERT INTO esg_details (company_id, category, sasb_topic, risk_score, adjustment_score) VALUES 
(1, 'E', '溫室氣體排放', 4, 1), -- 台積電: 初始4, 扣1 => 淨分3
(1, 'E', '水資源與廢水處理管理', 4, 0),
(1, 'S', '勞工法規', 3, 0),
(1, 'G', '商業道德', 4, 0);